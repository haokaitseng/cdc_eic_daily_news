import re
import pandas as pd

# This dictionary is copied literally from main.ipynb to ensure 100% accuracy.
dict_disease_name_mapping = { #multiple diseases are splitted by /
    '新型冠狀病毒肺炎': 'COVID-19',  #old name: new name
    '嚴重特殊傳染性肺炎': 'COVID-19',
    "新型冠狀肺炎": "COVID-19", # n=1
    #"新型冠狀病毒": "COVID-19", This is MERS
    "新冠併發重症(每週更新)": 'COVID-19',
    "新冠併發重症(本週更新)": "COVID-19", 
    '新冠併發重症': 'COVID-19',
    "中東呼吸症候冠狀病毒":"中東呼吸症候群冠狀病毒感染症",
    "中東呼吸症候群冠狀定毒":"中東呼吸症候群冠狀病毒感染症",
    "中東呼吸症候群狀病毒":"中東呼吸症候群冠狀病毒感染症",
    "猴痘": "M痘",
    "M痘(每月更新)": "M痘",
    "M痘(每週更新)": "M痘",
    "M痘(本週更新)": "M痘",
    "新型A型流感(每週更新)": "新型A型流感",
    '新型A型流感(本週更新)': "新型A型流感",
    '新型A型流感(H3N2v)': "新型A型流感",
    '新型A型流感(H9N2)' : "新型A型流感",
    "新型A型流感(H9N2/H10N3)": "新型A型流感",
    "新型A型流感(H5N1)": "新型A型流感",
    #"新型A型流感(哺乳動物感染禽流感)": "新型A型流感",
    "新型A型流感(H5)": "新型A型流感",
    "人類H5N1流感": "新型A型流感",
    'H7N9流感': '新型A型流感',
    "H5N1流感": "新型A型流感",
    "H3N8流感": "新型A型流感",
    "H3N1v流感": "新型A型流感",
    "H3N2v流感": "新型A型流感",
    "H5流感":  "新型A型流感",
    "H1N2v流感": "新型A型流感",
    "H5N6流感": "新型A型流感",
    "H9N2流感": "新型A型流感",
    "H3N1v流感": "新型A型流感",
    "H1N2v流感病例": "新型A型流感",
    "H1v流感":  "新型A型流感",
    'H3N2v流感': "新型A型流感",
    'H3N2v、H1N2v流感': "新型A型流感",
    "H1N1v流感": "新型A型流感",
    "H1N2流感": "新型A型流感",
    "H5N8流感": "新型A型流感",
    "H10N3流感" : "新型A型流感",
    "H1N1流感": "新型A型流感",
    "H1N1新型流感": "新型A型流感",
    "─H7N9流感": "新型A型流感",
    "H10N8流感": "新型A型流感",
    "H1N1v 流感": "新型A型流感",
    "H1N1新型流感  ( 加州 德州 )": "新型A型流感",
    "H1N1新型流感 ( 加州 德州 堪薩斯州 紐約 俄亥俄州)": "新型A型流感",
    "H1N1新型流感 ( 加州 德州 堪薩斯州)": "新型A型流感",
    "H1N1新型流感": "新型A型流感",
    "H1N1豬流感": "新型A型流感",
    "H1N2變異株": "新型A型流感",
    "H2N2流感": "新型A型流感",
    "H3N1病毒": "新型A型流感",
    "H3N2V流感": "新型A型流感",
    "H3N2v、H3v流感": "新型A型流感",
    "H3N2豬流感": "新型A型流感",
    "H3流感": "新型A型流感",
    "H3豬流感": "新型A型流感",
    "H5N1、H9N2流感": "新型A型流感",
    "H5N1疫苗": "新型A型流感",
    "H5N2高病原性禽流感": "新型A型流感",
    "H5N6、H7N9流感": "新型A型流感",
    "H7N2流感": "新型A型流感",
    "H7N4流感": "新型A型流感",
    "H7N7流感": "新型A型流感",
    "H7N9": "新型A型流感",
    "H7N9、H5N6流感": "新型A型流感",
    "H7流感": "新型A型流感",
    "H7禽流感": "新型A型流感",
    "H9流感": "新型A型流感",
    "新型A型流感(哺乳動物感染禽流感)":"新型A型流感",
    "新型A型流感(疫苗)":"新型A型流感",
    "新型A流感":"新型A型流感",
    "人類H5N1流感" :"新型A型流感",
    "人類禽流感":"新型A型流感",
    "新型Ａ型流感(哺乳動物感染禽流感)":"新型Ａ型流感",
    "流感、新型A型流感":"流感/新型A型流感",
    "Echovirus 30 (E30)": "腸病毒",
    '1腸道菌感染症': '腸道菌感染症',
    # "病毒性腸胃炎(諾羅病毒)": "",
    "病毒性腸胃炎(沙門氏菌)": "沙門氏菌感染症",
    "沙門氏菌症":"沙門氏菌感染症",
    "沙門氏桿菌":"沙門氏菌感染症",
    "沙門氏菌感染": "沙門氏菌感染症",
    "抗藥性沙門氏菌": "沙門氏菌感染症",
    "沙門氏菌": "沙門氏菌感染症",
    "克羅諾菌與沙門氏菌感染": "克羅諾菌/沙門氏菌感染症",
    "沙門氏菌(Salmonella Agbeni)": "沙門氏菌感染症",
    "細菌性腸胃炎(沙門氏菌)": "沙門氏菌感染症",
    "細菌性腸胃炎(曲狀桿菌/沙門氏菌)": "細菌性腸胃炎(曲狀桿菌)/沙門氏菌感染症",
    "曲狀桿菌": "細菌性腸胃炎(曲狀桿菌)",
    "多重抗藥性曲狀桿菌": "細菌性腸胃炎(曲狀桿菌)",
    "大腸桿菌、彎曲桿菌":"大腸桿菌感染症/彎曲桿菌",
    "廣泛抗藥性大腸桿菌":"大腸桿菌感染症",
    "大腸桿菌感染":"大腸桿菌感染症",
    "布氏桿菌":"布氏桿菌病",
    "不明原因腹瀉": "腹瀉", # pending
    "輪狀病毒感染":"輪狀病毒",
    "不明原因疾病死亡": "不明原因致死疾病",
    "不明原因死亡": "不明原因致死疾病",
    "不明原因死亡、黃熱病" : "不明原因致死疾病/黃熱病",
    "不明原因致死疾病(疑似炭疽病)": "不明原因致死疾病",
    "不明原因疾病(急性腹瀉與嘔吐)": "不明原因疾病",
    "不明原因呼吸道感染":"不明原因疾病",
    "不明原因神經系統畸形": "不明原因疾病",
    "不明原因肺炎": "不明原因疾病",
    "不明原因神經系統疾病":"不明原因疾病",
    '不明原因腦脊髓膜炎': "不明原因疾病",
    "不明原因出血": "不明原因疾病",
    "不明原因出血熱": "不明原因疾病",
    "不明原因疾病(番茄流感)":  "不明原因疾病",
    "不明原因出血疾病": "不明原因疾病", 
    "不明原因急性肝炎": "兒童急性嚴重不明原因肝炎",# 2022年重要監測疾病，不應跟不明原因疾病混為一談
    "不明蟲媒發熱疾病": "不明原因疾病",
    "不明原因腦炎與細菌性腦膜炎": "不明原因疾病",
    "不明原因腦膜炎": "不明原因疾病",
    "不明原因急性腎衰竭": "不明原因疾病",
    "不明原因肝炎": "兒童急性嚴重不明原因肝炎", # 2022年重要監測疾病，不應跟不明原因疾病混為一談
    "不明原因急性腎衰竭": "不明原因疾病",
    "不明原因呼吸道疾病": "不明原因疾病",
    "不明原因腦膜炎": "不明原因疾病",
    "不明原因出血熱、瘧疾": "不明原因疾病/瘧疾",
    "不明原因呼吸道感染": "不明原因疾病",
    "兒童急性嚴重不明原因肝炎": "兒童急性嚴重不明原因肝炎",# 2022年重要監測疾病，不應跟不明原因疾病混為一談
    "不明原因呼吸道疾病": "不明原因疾病",
    "不明原因出血熱": "不明原因疾病", 
    "不明原因肺炎": "不明原因疾病",
    "不明原因發病": "不明原因疾病",
    "不明疾病" :"不明原因疾病",
    "不明蟲媒發熱疾病": "不明原因疾病",
    "不明病因皮膚病" :"不明原因疾病",
    "不明原因神經系統畸形" : "不明原因疾病",
    "不明原因腦炎": "不明原因疾病",
    "不明皮膚疾病" : "不明原因疾病",
    "不明皮膚病":"不明原因疾病",
    "人類免疫缺乏病毒感染": "人類免疫缺乏病毒(愛滋病毒)感染",
    "HIV感染": "人類免疫缺乏病毒(愛滋病毒)感染",
    "HIV": "人類免疫缺乏病毒(愛滋病毒)感染",
    "HIV/AIDS": "人類免疫缺乏病毒(愛滋病毒)感染",
    "愛滋病": "人類免疫缺乏病毒(愛滋病毒)感染",
    "梅毒與先天性梅毒": "梅毒/先天性梅毒",
    "猩紅熱與侵襲性A群鏈球菌感染": "猩紅熱與A群鏈球菌感染",
    "猩紅熱與侵襲性A群鏈球菌感染症": "猩紅熱與A群鏈球菌感染",
    "猩紅熱及侵襲性A型鏈球菌感染": "猩紅熱與A群鏈球菌感染",
    "溶血性A群鏈球菌感染": "A群鏈球菌感染",
    "侵襲性A群鏈球菌": "A群鏈球菌感染",
    "克里米亞剛果出血熱": "克里米亞-剛果出血熱",
    "克里米-亞剛果出血熱": "克里米亞-剛果出血熱",
    "立百病毒": "立百病毒感染症",
    "立百病毒感染": "立百病毒感染症",
    "立百病毒(Nipah Virus)":"立百病毒感染症",
    "漢他病毒": "漢他病毒症後群",
    "漢他病毒感染症": "漢他病毒症後群",
    "漢他病毒出血熱": "漢他病毒症後群",
    "漢他病毒肺症候群": "漢他病毒症後群",
    "皮膚利什曼原蟲症" : "利什曼原蟲症", 
    "萊姆病、蜱媒腦炎": "萊姆病/蜱媒腦炎",
    "水痘/A型肝炎":"水痘/急性病毒性A型肝炎",
    "E型肝炎": "急性病毒性E型肝炎",
    "A型肝炎": "急性病毒性A型肝炎",
    "B型肝炎": "急性病毒性B型肝炎",
    "C型肝炎": "急性病毒性B型肝炎",
    "E型肝炎病例": "急性病毒性E型肝炎",
    "中東呼吸症候群冠狀病毒": "中東呼吸症候群冠狀病毒感染症",
    "發熱伴血小板減少綜合症(SFTS)":"發熱伴血小板減少綜合症",
    "傳染性紅斑": "傳染性紅斑症",
    "人類間質肺炎病毒(HMPV)": "人類間質肺炎病毒感染",
    "人類間質肺炎": "人類間質肺炎病毒感染",
    "人類間質肺炎病毒": "人類間質肺炎病毒感染",
    "伊波拉病毒": "伊波拉病毒感染", # Sudan病毒疾病是伊波拉病毒感染的一種
    "伊波拉出血熱" : "伊波拉病毒感染",
    "伊波拉病毒感染症" : "伊波拉病毒感染",
    "伊波拉病毒出血熱":"伊波拉病毒感染",
    "剛果出血熱死": "剛果出血熱",
    "急性無力脊髓炎(Acute Flaccid Myelitis, AFM)": "急性無力脊髓炎",
    "巴利症候群": "格林巴利症候群",
    "巴利症候群(GBS)": "格林巴利症候群",
    "ZIKA病毒": "茲卡病毒感染",
    "茲卡病毒": "茲卡病毒感染",
    "Zika病毒": "茲卡病毒感染",
    "5腸道菌感染症": "腸道菌感染症",
    "4腸道菌感染症": "腸道菌感染症",
    "西尼羅病毒": "西尼羅熱",
    "李斯特菌": "李斯特菌症",
    "1綠膿桿菌感染症": "綠膿桿菌感染症",
    "侵襲性b型嗜血桿菌" : "侵襲性b型嗜血桿菌感染症",
    "侵襲性b型嗜血桿菌感染症病例" : "侵襲性b型嗜血桿菌感染症", 
    "侵襲性ｂ型嗜血桿菌":"侵襲性b型嗜血桿菌感染症",
    "侵襲性ｂ型嗜血桿菌感染症":"侵襲性b型嗜血桿菌感染症",
    "侵襲性肺炎鏈球菌" : "侵襲性肺炎鏈球菌感染症",
    "獲取肺炎鏈球菌":"侵襲性肺炎鏈球菌感染症",
    "侵襲性肺炎鏈球菌感染症死" :"侵襲性肺炎鏈球菌感染症",
    "人類副腸孤病毒":"人類副腸孤病毒(PeV)",
    "傷寒、副傷寒":"傷寒/副傷寒",
    "克里米亞-剛果出血熱死" :"克里米亞-剛果出血熱",
    "出血熱、瘧疾" :"出血熱/瘧疾",
    "利什曼病":"利什曼原蟲症",
    "創傷弧菌":"創傷弧菌感染",
    "呼吸道疾病":"呼吸道傳染病",
    "哈特蘭病毒(Heartland Virus)":"哈特蘭病毒",
    "急性無力脊髓炎(AFM)":"急性無力脊髓炎",
    "小兒痲痺" :"小兒痲痺症",
    "小兒痲痺病毒":"小兒痲痺症",
    "小兒麻痺":"小兒痲痺症",
    "小兒麻痺病毒":"小兒痲痺症",
    "小兒麻痺症病例":"小兒痲痺症",
    "小頭畸型、茲卡病毒感染症":"茲卡病毒感染症",
    "小頭畸形":"茲卡病毒感染症",
    "小頭症":"茲卡病毒感染症",
    "小頭症、格林-巴利症候群(GBS)":"茲卡病毒感染症/格林-巴利症候群(GBS)",
    "小頭症、茲卡病毒感染症":"茲卡病毒感染症",
    "格林-巴利症候群(GBS)、茲卡病毒感染症":"格林-巴利症候群(GBS)/茲卡病毒感染症",
    "格林-巴利症候群、茲卡病毒感染":"格林-巴利症候群(GBS)/茲卡病毒感染症",
    "茲卡病毒感染":"茲卡病毒感染症",
    "茲卡病毒感染症、GBS":"茲卡病毒感染症/格林-巴利症候群(GBS)",
    "茲卡病毒感染症、小頭症":"茲卡病毒感染症",
    "茲卡病毒感染症、小頭症、GBS":"茲卡病毒感染症",
    "屈公病、登革熱":"屈公病/登革熱",
    "巴貝氏蟲病":"巴貝氏蟲症",
    "庫賈氏症":"庫賈氏病",
    "廣東住血線蟲":"廣東住血線蟲感染症",
    "廣泛抗藥性(XDR)傷寒":"廣泛抗藥性傷寒(XDR)",
    "廣泛抗藥性傷寒":"廣泛抗藥性傷寒(XDR)",
    "性病":"性傳染病",
    "手口足病":"手足口病",
    "抗萬古黴素腸道鏈球菌":"抗萬古霉素腸道鏈球菌",
    "旋毛蟲病":"旋毛蟲感染症",
    "李斯特桿菌":"李斯特菌症",
    "李斯特氏菌":"李斯特菌症",
    "東部馬腦炎":"東方馬腦炎",
    "水痘、猩紅熱":"水痘/猩紅熱",
    "波旁病毒":"波旁病毒感染",
    "波瓦尚病毒感染":"波瓦尚病毒",
    "波瓦桑病毒":"波瓦尚病毒",
    "波瓦桑病毒性腦炎":"波瓦尚病毒",
    "洛磯山斑點熱":"洛磯山斑疹熱",
    "流感疫苗":"流感",
    "流感病毒變異株":"流感",
    "流行性腦脊髓":"流行性腦脊隨膜炎",
    "流行性角結膜炎、急性出血性結膜炎":"流行性角結膜炎/急性出血性結膜炎",
    "漢他病毒、鉤端螺旋體病":"漢他病毒/鉤端螺旋體病",
    "漢他病毒感染":"漢他病毒症候群",
    "炭疽":"炭疽病",
    "炭疽桿菌":"炭疽病",
    "牛痘":"牛痘病毒",
    "犬心絲蟲病":"犬心絲蟲感染症",
    "玻那病毒":"玻那病毒感染",
    "球黴菌溪谷熱":"球黴菌症",
    "環孢子症":"環孢子蟲症",
    "環孢子蟲病":"環孢子蟲症",
    "環孢子蟲":"環孢子蟲症",
    "疑似腸病毒":"腸病毒",
    "疥瘡":"疥瘡感染症",
    "登革":"登革熱",
    "登革熱、茲卡病毒感染症":"登革熱/茲卡病毒感染症",
    "登革熱和麻疹":"登革熱麻疹",
    "登革熱疫苗":"登革熱",
    "福氏內格里阿米巴原蟲":"福氏內格里阿米巴腦膜腦炎",
    "福氏內格里阿米巴腦膜炎":"福氏內格里阿米巴腦膜腦炎",
    "福氏內格阿米巴腦膜腦炎":"福氏內格里阿米巴腦膜腦炎",
    "福氏耐格里阿米巴":"福氏內格里阿米巴腦膜腦炎",
    "福氏耐格里阿米巴原蟲":"福氏內格里阿米巴腦膜腦炎",
    "綠膿桿菌":"綠膿桿菌感染",
    "綠膿桿菌感染症":"綠膿桿菌感染",
    "羅斯河病毒":"羅斯河病毒感染",
    "羅絲河病毒":"羅斯河病毒感染",
    "聖路易腦炎":"聖路易斯腦炎",
    "肉毒桿菌":"肉毒桿菌中毒",
    "肺結核":"結核病",
    "腦炎、日本腦炎":"腦炎/日本腦炎",
    "腦炎及日本腦炎":"腦炎/日本腦炎",
    "腸病毒、諾羅病毒":"腸病毒/諾羅病毒",
    "腸胃炎、諾羅病毒":"腸胃炎/諾羅病毒",
    "諾羅病毒感染":"諾羅病毒",
    "腸道出血大腸桿菌感染症":"腸道出血性大腸桿菌感染症",
    "腸道出血性大腸桿菌":"腸道出血性大腸桿菌感染症",
    "腸道出血性大腸桿菌感染症(O26)":"腸道出血性大腸桿菌感染症",
    "腹瀉、傷寒":"腹瀉/傷寒",
    "腺病毒感染":"腺病毒",
    "蜱傳腦炎":"蜱媒腦炎",
    "蠅蛆病":"蠅蛆症",
    "血吸蟲":"血吸蟲病",
    "血吸蟲症":"血吸蟲病",
    "西尼羅河病毒":"西尼羅熱",
    "詹姆斯峽谷病毒":"詹姆斯敦峽谷病毒",
    "詹姆斯敦峽谷病毒感染":"詹姆斯敦峽谷病毒",
    "退伍軍人症":"退伍軍人病",
    "金黃葡萄球菌":"金黃色葡萄球菌",
    "鉤端螺旋體":"鉤端螺旋體病",
    "鉤端螺旋體症":"鉤端螺旋體病",
    "阿米巴":"阿米巴性痢疾",
    "隱孢子蟲":"隱胞子蟲症",
    "隱孢子蟲感染症":"隱胞子蟲症",
    "隱孢子蟲病":"隱胞子蟲症",    
    "隱胞子蟲":"隱胞子蟲症",
    "隱胞子蟲病":"隱胞子蟲症",    
    "隱孢子蟲症":"隱胞子蟲症",
    "霍亂、猴痘":"霍亂/M痘",    
    "食媒性疾病":"食媒性傳染病",
    "食源性疾病":"食媒性傳染病",    
    "馬堡出血熱":"馬堡病毒出血熱",
    "麥地那龍線蟲":"麥地那龍線蟲病",
    "麻疹、德國麻疹":"麻疹/德國麻疹",
    "黃麴毒素":"黃麴毒素中毒",
    "鼠傳E型肝炎":"鼠傳人E型肝炎",
}

dict_disease_name_mapping_en = {
    "COVID-19": "COVID-19",
    "M痘": "Mpox",
    "新型A型流感": "Novel influenza A",
    "登革熱": "Dengue",
    "小兒麻痺症": "Polio",
    "麻疹": "Measles",
    "流感": "Influenza",
    "禽類禽流感": "Avian influenza (animal)",
    "霍亂": "Cholera",
    "伊波拉病毒感染": "Ebola",
    "茲卡病毒感染症": "Zika",
    "腸病毒": "NPEV",
    "不明原因疾病": "Mystery disease", 
    "屈公病": "Chikungunya",
    "沙門氏菌感染症": "Salmonellosis",
    "中東呼吸症候群冠狀病毒感染症": "MERS",
    "瘧疾": "Malaria",
    "黃熱病": "Yellow fever",
    "狂犬病": "Rabies",
    "西尼羅熱": "West Nile virus disease",
    "退伍軍人病": "Legionnaires' disease",
    "百日咳": "Pertussis",
    "流行性腦脊髓膜炎": "Meningococcal meningitis",
    "大腸桿菌": "E. coli infection",
    "炭疽病": "Anthrax",
    "克里米亞-剛果出血熱": "Crimean-Congo hemorrhagic fever",
    "急性病毒性A型肝炎": "Hepatitis A",
    "拉薩熱": "Lassa fever",
    "諾羅病毒": "Norovirus infection",
    "鉤端螺旋體病": "Leptospirosis",
    "人類免疫缺乏病毒(愛滋病毒)感染":"AIDS",
    "人類間質肺炎病毒感染":"hMPV",
    "結核病":"Tuberculosis",
    "兒童急性嚴重不明原因肝炎":"Acute severe hepatitis of unknown etiology in children",
    "李斯特菌症":"Listeriosis",
    "桿菌性痢疾":"Shigellosis"
}

def clean_disease_name(name):
    """
    Cleans the disease name by removing content in parentheses and leading digits.
    """
    if not isinstance(name, str):
        return name
    name = re.sub(r'\(.*?\)', '', name)     # 移除括號內的內容
    name = re.sub(r'^\d+', '', name)        # 去除數字開頭
    return name.strip()

def map_disease_names(disease_str, mapping_dict):
    """
    Maps disease names using the provided mapping dictionary.
    Handles multiple diseases separated by '/'.
    """
    if pd.isna(disease_str):
        return None
    
    # Split if multiple diseases
    parts = [p.strip() for p in str(disease_str).split('/')]
    
    # Map each part, default to the original if not in mapping
    mapped_parts = [mapping_dict.get(p, p) for p in parts]
    
    # Re-join with /
    return "/".join(mapped_parts)
